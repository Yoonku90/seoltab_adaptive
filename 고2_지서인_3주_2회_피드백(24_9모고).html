<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>고2_지서인 학생 · 내신 학습 지식맵 (2025-09-11)</title>
  <style>
   :root{
   --bg: #f6f7fb; --card:#ffffff; --border:#e6e8ef; --text:#0f172a; --muted:#64748b;
   --indigo:#4f46e5; --green:#16a34a; --yellow:#f59e0b; --red:#ef4444; --blue:#3b82f6;
   --green-100:#dcfce7; --yellow-100:#fef9c3; --red-100:#fee2e2; --gray-100:#f1f5f9; --blue-100:#dbeafe;
   }
   *{box-sizing:border-box} body{margin:0;background:linear-gradient(180deg,#ffffff, var(--bg));color:var(--text);font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",Apple SD Gothic Neo,Pretendard,Helvetica,Arial,sans-serif}
   .container{max-width:1120px;margin:0 auto;padding:24px}
   .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;}
   .between{display:flex;align-items:center;justify-content:space-between;gap:12px}
   .card{background:var(--card);border:1px solid var(--border);border-radius:20px;box-shadow:0 4px 12px rgba(15,23,42,.04)}
   .p-16{padding:16px}.p-20{padding:20px}.p-24{padding:24px}
   .btn{border:1px solid var(--border);background:#fff;border-radius:12px;padding:10px 14px;cursor:pointer}
   .btn.active{background:var(--indigo);color:#fff;border-color:var(--indigo)}
   .input{border:1px solid var(--border);background:#fff;border-radius:12px;padding:10px 12px;min-width:260px}
   .grid{display:grid;gap:16px}
   @media(min-width:640px){.grid-2{grid-template-columns:repeat(2,minmax(0,1fr));}}
   @media(min-width:1024px){.grid-3{grid-template-columns:repeat(3,minmax(0,1fr));}}
   .stat{min-width:240px}
   .hbar{height:8px;background:var(--gray-100);border-radius:999px;overflow:hidden}
   .hbar > span{display:block;height:100%}
   .pill{padding:3px 8px;border-radius:999px;font-size:11px;font-weight:700;display:inline-block}
   .legend .pill{border:1px solid var(--border);}
   .muted{color:var(--muted)}
   .title{font-weight:800;letter-spacing:-.3px}
   .sub{font-size:12px}
   .kc-card{display:flex;gap:12px}
   .kc-ico{flex:0 0 auto;width:36px;height:36px;border-radius:12px;background:#f8fafc;display:grid;place-items:center;border:1px solid var(--border)}
   .small{font-size:12px}
   .type-card{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
   .kbd{font-variant-numeric:tabular-nums}
   .footer{font-size:12px;color:var(--muted);display:flex;gap:8px;align-items:flex-start}
   .feedback-section h3 { font-size: 20px; margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px; }
   .feedback-section h4 { font-size: 16px; margin: 24px 0 8px 0; color: var(--indigo); border-left: 3px solid var(--indigo); padding-left: 8px;}
   .feedback-section .summary { font-size: 14px; color: var(--muted); margin-top: -12px; margin-bottom: 24px; }
   .feedback-section hr { border: 0; border-top: 1px solid var(--border); margin: 24px 0; }
   .feedback-section blockquote { margin: 12px 0; padding: 12px; background-color: var(--gray-100); border-left: 4px solid var(--border); border-radius: 8px; font-size: 13px; }
   .feedback-section .analysis { margin-top: 8px; }
   .feedback-section .analysis strong { color: var(--text); }
  </style>
</head>
<body>
  <div class="container">
    <div class="between" style="gap:16px;flex-wrap:wrap">
      <div>
        <div id="mainTitle" class="title" style="font-size:24px">24년 9월 고2 모의고사 <span style="color:var(--indigo)">KC & 유형 성취도</span> 대시보드</div>
        <div id="subHeader" class="sub muted">이름: <strong>고2_지서인</strong> · 시험일: <strong>2025-09-11</strong> · 교재: 2024년 9월 고2 모의고사</div>
      </div>
      <div class="row">
        <button id="printBtn" class="btn">내보내기/인쇄</button>
      </div>
    </div>

    <div class="row" style="margin-top:16px;align-items:center">
      <div class="row">
        <button data-view="all" class="btn view-btn active" aria-pressed="true">전체</button>
        <button data-view="core" class="btn view-btn" aria-pressed="false">기반</button>
        <button data-view="reading" class="btn view-btn" aria-pressed="false">본문</button>
        <button data-view="types" class="btn view-btn" aria-pressed="false">문제 유형</button>
        <button data-view="feedback" class="btn view-btn" aria-pressed="false">피드백</button>
      </div>
      <div style="flex:1"></div>
      <input id="search" class="input" placeholder="KC 코드/이름/설명/유형 검색" />
    </div>

    <div class="grid grid-3" style="margin-top:16px">
      <div class="card p-16 stat">
        <div class="muted small">KC 평균 성취도</div>
        <div id="avgKC" class="title" style="font-size:22px;margin-top:4px">—</div>
        <div class="hbar" style="margin-top:8px"><span id="avgKCBar" style="width:0"></span></div>
      </div>
      <div class="card p-16 stat">
        <div class="muted small">문제 유형 평균 성취도</div>
        <div id="avgType" class="title" style="font-size:22px;margin-top:4px">—</div>
        <div class="hbar" style="margin-top:8px"><span id="avgTypeBar" style="width:0"></span></div>
      </div>
       <div class="card p-16 stat">
        <div class="muted small">문제 정답률</div>
        <div class="row" style="align-items:baseline;gap:6px">
          <div id="avgCorrectRate" class="title" style="font-size:22px;margin-top:4px">—</div>
          <div id="totalCount" class="muted" style="font-weight:600; font-size: 14px;"></div>
        </div>
        <div class="hbar" style="margin-top:8px"><span id="avgCorrectRateBar" style="width:0"></span></div>
      </div>
    </div>

    <div class="legend row card p-16" style="margin-top:16px">
      <div class="muted small">범례:</div>
      <span class="pill" style="background:var(--green-100);color:var(--green)">우수 ≥ 85%</span>
      <span class="pill" style="background:var(--yellow-100);color:var(--yellow)">60–84%</span>
      <span class="pill" style="background:var(--red-100);color:var(--red)">1–59%</span>
      <span class="pill" style="background:#e5e7eb;color:#374151">미평가</span>
    </div>

    <div id="mount"></div>

    <section class="card p-20" style="margin-top:16px" id="focusBox">
      <div class="between">
        <div>
          <div class="title" style="font-size:18px">📌 집중 보완 영역 (상위 3개 KC)</div>
          <div class="sub muted">점수가 낮은 순으로 자동 추천</div>
        </div>
      </div>
      <ol id="focusList" class="small" style="margin-top:8px;padding-left:18px"></ol>
    </section>

    <div class="footer" style="margin-top:16px">
      <span>색상 기준: 🟢 85% 이상, 🟡 60–84%, 🟥 1–59%, 회색=미평가. 검색 또는 상단 버튼으로 뷰를 전환할 수 있습니다. 인쇄 버튼으로 PDF 저장 가능.</span>
    </div>
  </div>

  <script>
  (() => { 'use strict';
    // ======== 데이터 설정 ========
    const studentName = "고2_지서인";
    const examDate = "2025-09-11";

    const kcScores = {
      "KC-24-9-h2-18": { score: 100, correct: 13, total: 13 },
      "KC-24-9-h2-19": { score: 100, correct: 13, total: 13 },
      "KC-24-9-h2-20": { score: 93.75, correct: 12, total: 13 },
      "KC-24-9-h2-21": { score: 92.31, correct: 12, total: 13 },
      "KC-24-9-h2-22": { score: 100, correct: 13, total: 13 },
      "KC-24-9-h2-23": { score: 100, correct: 13, total: 13 },
      "KC-24-9-h2-24": { score: 100, correct: 13, total: 13 },
      "KC-24-9-h2-26": { score: 92.31, correct: 12, total: 13 },
      "KC-24-9-h2-29": { score: 100, correct: 13, total: 13 },
      "KC-24-9-h2-30": { score: 100, correct: 13, total: 13 },
      "KC-24-9-h2-31": { score: 85.94, correct: 11, total: 13 },
      "KC-24-9-h2-32": { score: 100, correct: 13, total: 13 },
      "KC-24-9-h2-33": { score: 100, correct: 13, total: 13 },
      "KC-24-9-h2-34": { score: 100, correct: 13, total: 13 },
      "KC-24-9-h2-35": { score: 100, correct: 13, total: 13 },
      "KC-24-9-h2-36": { score: 92.42, correct: 12, total: 13 },
      "KC-24-9-h2-37": { score: 84.21, correct: 11, total: 13 },
      "KC-24-9-h2-38": { score: 92.31, correct: 12, total: 13 },
      "KC-24-9-h2-39": { score: 91.53, correct: 11, total: 12 },
      "KC-24-9-h2-40": { score: 93.22, correct: 11, total: 12 },
      "KC-24-9-h2-4142": { score: 83.33, correct: 10, total: 12 }
    };

    const typeScores = [
      { code:"251", name:"옳고 그름 판단하기", area:"문법/어법", score:100.0, kcs:["KC-24-9-h2-4142"], correct: 1, total: 1 },
      { code:"311", name:"핵심 내용 파악하기", area:"본문", score:97.82, kcs:["KC-24-9-h2-18", "KC-24-9-h2-19", "KC-24-9-h2-20", "KC-24-9-h2-21"], correct: 100, total: 102 },
      { code:"312", name:"세부 내용 파악하기", area:"본문", score:93.19, kcs:["KC-24-9-h2-26", "KC-24-9-h2-30", "KC-24-9-h2-4142"], correct: 64, total: 69 },
      { code:"314", name:"지문 요약하기", area:"본문", score:94.41, kcs:["KC-24-9-h2-30", "KC-24-9-h2-31", "KC-24-9-h2-32"], correct: 83, total: 88 },
      { code:"321", name:"문맥 파악하기 (무관한 문장)", area:"본문", score:0.0, kcs:["KC-24-9-h2-20"], correct: 0, total: 1 },
      { code:"324", name:"밑줄 친 부분 추론하기", area:"본문", score:100.0, kcs:["KC-24-9-h2-23", "KC-24-9-h2-34"], correct: 5, total: 5 },
      { code:"342", name:"영어로 표현하기", area:"본문", score:100.0, kcs:["KC-24-9-h2-18"], correct: 4, total: 4 }
    ];
    
    const totalCorrectAll = typeScores.reduce((sum, t) => sum + (t.correct || 0), 0);
    const totalProblemsAll = typeScores.reduce((sum, t) => sum + (t.total || 0), 0);

    const kcMeta = {
      "KC-24-9-h2-18": { area: "본문", label: "아파트 커뮤니티 정원 보수 요청", desc: "정원 시설물 문제점 지적 및 보수 요청, 비용 부담 의사 전달" },
      "KC-24-9-h2-19": { area: "본문", label: "입국 심사에서의 심경 변화", desc: "엄격한 심사관으로 인한 불안감이 통과 후 안도감으로 바뀌는 과정" },
      "KC-24-9-h2-20": { area: "본문", label: "자녀의 걱정 통제 방법 교육", desc: "걱정은 의지로 통제 가능한 감정임을 인지시키고 행동 변화 유도" },
      "KC-24-9-h2-21": { area: "본문", label: "창의적 조직 문화의 필요성", desc: "규칙(교향악단)에서 벗어나 자율과 유연성(재즈 밴드)으로 혁신 추구" },
      "KC-24-9-h2-22": { area: "본문", label: "위기 상황 속 신뢰할 수 있는 정보원의 중요성", desc: "공신력 있는 정보원 부재 시 소문 확산의 위험성" },
      "KC-24-9-h2-23": { area: "본문", label: "과학의 본질에 대한 두 가지 상반된 관점", desc: "과학을 '역사적 활동'으로 보는 관점과 '객관적 탐구'로 보는 관점 대조" },
      "KC-24-9-h2-24": { area: "본문", label: "획일적인 법적 책임 연령 기준의 문제점", desc: "개인별 정신 발달 속도 차이를 고려하지 않는 획일적 연령 기준 비판" },
      "KC-24-9-h2-26": { area: "본문", label: "생물학자 Charles Elton의 생애와 업적", desc: "현대 생태학 형성에 기여한 Elton의 학업, 경력, 저술 활동" },
      "KC-24-9-h2-29": { area: "본문", label: "생태 중심 경제관으로의 시급한 전환 촉구", desc: "인간 중심 경제관에서 생태 중심 경제관으로의 관점 전환 필요성 강조" },
      "KC-24-9-h2-30": { area: "본문", label: "초기 인류 진화의 핵심 동력", desc: "직립 보행, 도구 제작, 고에너지 식단이 뇌 발달과 영역 확장으로 이어진 과정" },
      "KC-24-9-h2-31": { area: "본문", label: "과정의 공정성과 실패의 심리적 귀인", desc: "과정의 공정성 여부에 따라 실패 원인을 외부 혹은 내부로 돌리는 심리" },
      "KC-24-9-h2-32": { area: "본문", label: "과학적 분석으로 밝혀낸 패션의 주기성", desc: "Kroeber의 연구를 통해 증명된 패션의 100년 단위 규칙적 주기성" },
      "KC-24-9-h2-33": { area: "본문", label: "기술 발전이 초래하는 노동 시장의 위기와 불평등", desc: "기술 발전이 부를 증대시키면서 동시에 불평등과 노동 시장 붕괴를 야기" },
      "KC-24-9-h2-34": { area: "본문", label: "전문성의 역설 (숙련될수록 설명은 어렵다)", desc: "전문가의 지식은 암묵적이어서 숙련도가 높을수록 기본 원리 설명이 어려움" },
      "KC-24-9-h2-35": { area: "본문", label: "영양소 보존을 위한 식품 가공 방식", desc: "제분 등 영양소 파괴 방식과 최소 가공, 발효 등 보존 방식 대조" },
      "KC-24-9-h2-36": { area: "본문", label: "유능함의 역설 (완벽함보다 허점이 매력적이다)", desc: "지나치게 유능한 사람보다 약간의 실수를 보이는 사람이 더 호감을 얻는 현상" },
      "KC-24-9-h2-37": { area: "본문", label: "기계적 정보 처리와 유기체의 의미 평가", desc: "컴퓨터 알고리즘과 달리 꿀벌은 정보를 자신의 경험에 비추어 평가함" },
      "KC-24-9-h2-38": { area: "본문", label: "바이러스성 전염과 행동 전염의 유사점 및 차이점", desc: "'근접성'은 유사하나 '가시성'과 '결과의 가치'에서 차이점을 보임" },
      "KC-24-9-h2-39": { area: "본문", label: "동면, 수면, 그리고 휴면의 개념 구분", desc: "동면과 수면의 차이, 곰의 겨울잠은 동면이 아닌 휴면(torpor)임을 설명" },
      "KC-24-9-h2-40": { area: "본문", label: "또래의 존재가 아동의 도움 행동에 미치는 연령별 차이", desc: "또래 존재가 어린 아동의 도움 행동은 촉진, 나이 든 아동은 억제함" },
      "KC-24-9-h2-4142": { area: "본문", label: "권위에 대한 질문의 중요성과 부모의 역할", desc: "아이들의 질문을 진지하게 받아들여 스스로 생각하는 힘을 길러주어야 함" }
    };
    const groups = [
      { id: "core", title: "A. 기반 지식", subtitle: "문법·어휘 기반", items:[] },
      { id: "reading", title: "B. 적용 · 본문", subtitle: "24년 9월 고2 모의고사", items: Object.keys(kcMeta) }
    ];
    
    function getFeedbackHTML() { 
      return `
      <h3>📊 상세 분석 및 맞춤 피드백</h3>
      <div>
        <p style="padding:12px; background-color: var(--gray-100); border-radius: 12px; font-size: 14px; margin-top:0;">
          <strong>총평:</strong> ${studentName} 학생의 전체 성취도는 <strong>95%</strong>로, 영어 독해의 기본기가 매우 탄탄한 상태입니다. 대부분의 지문을 정확하게 이해하고 있으며, 이는 100%에 가까운 다수의 KC 성취도가 증명합니다. 이제 최상위권으로 도약하기 위해, 강점 속에 숨어있는 단 하나의 결정적 약점을 개선하는 데 집중할 필요가 있습니다.
        </p>
      </div>
      <hr>
      <h4>📚 전체 흐름 파악: 숲의 '연결고리'를 놓치는 상태</h4>
      <p class="summary">
        <strong>핵심 약점: 글의 통일성을 해치는 문장 찾기 (유형 321 성취도: 0%)</strong>
        <br>글의 주제나 세부 정보 파악 능력은 매우 뛰어나지만, 문장과 문장 사이의 논리적 연결성을 판단하여 주제에서 벗어난 문장을 솎아내는 능력이 결정적으로 부족합니다. 이는 관련 유형에서 0%라는 결과로 명확하게 드러났습니다.
      </p>
      <blockquote>
        <p><strong>대표 문제 예시 (9회 15번)</strong></p>
        <p><strong>[지문]</strong> For some reason, young people seem to believe that worry is a fact of life over which they have little or no control. (B) Consequently, they don't even try to stop. (C) The weather forecast predicts heavy rain and thunderstorms for the weekend, causing many outdoor events to be cancelled. Therefore, you need to convince them that worry, like guilt and fear, is nothing more than an emotion...</p>
        <p><strong>[문제]</strong> 15. 다음 글에서 전체 흐름과 관계없는 문장을 고르시오.</p>
        <p>➡️ <strong>정답: ③번</strong> / <strong>학생 답안: ②번</strong></p>
      </blockquote>
      <p class="analysis"><strong>분석:</strong> 정답은 ③번이지만, 학생은 ②번을 골랐습니다. 이는 앞 문장의 내용("젊은이들은 걱정을 통제할 수 없다고 믿는다")와 ②번 문장의 내용("<strong>결과적으로(Consequently)</strong>, 그들은 멈추려고 시도조차 하지 않는다") 사이의 <strong>강력한 인과 관계</strong>를 놓쳤다는 의미입니다. 'Consequently'는 앞선 내용의 당연한 결과를 보여주는 결정적 단서입니다. 반면, ③번 문장은 '날씨 예보'라는, '걱정'이라는 글의 핵심 주제와 아무런 관련이 없는 완전히 동떨어진 내용이므로 정답입니다. 이처럼 각 문장이 앞뒤 문장과 어떤 논리적 관계로 묶여 있는지 파악하는 훈련이 필요합니다.</p>
      <hr>
      <h4>🤔 추상적 개념 독해: '단어'의 '숨은 뜻' 파악 능력 부족</h4>
      <p class="summary">
        <strong>핵심 약점: 추상적 개념의 문맥적 의미 추론 (KC-24-9-h2-31, 37, 4142 평균 84.5%)</strong>
        <br>전반적인 독해력은 우수하지만, 철학적이거나 심리적인 내용을 다루는 추상적인 지문에서 성취도가 다소 낮게 나타나는 경향이 있습니다. 이는 단순히 글자 그대로의 해석을 넘어, 문맥 속에서 단어가 함축하는 핵심적인 의미를 추론하는 데 약점이 있음을 보여줍니다.
      </p>
      <blockquote>
        <p><strong>대표 문제 예시 (8회 11번)</strong></p>
        <p><strong>[지문]</strong> If the process is fair, however, we cannot nearly as easily externalize the outcome; we got what we got <strong>fair and square</strong>. When the process is fair we believe that our outcome is deserved...</p>
        <p><strong>[문제]</strong> 11. 밑줄 친 \`fair and square\`가 다음 글에서 의미하는 바로 가장 적절한 것은?</p>
        <p><strong>[선택지]</strong><br>
        ① justly and honestly<br>
        ② unexpectedly and suddenly<br>
        ③ gradually and steadily</p>
        <p>➡️ <strong>정답: ①번</strong> / <strong>학생 답안: ③번</strong></p>
      </blockquote>
      <p class="analysis"><strong>분석:</strong> 정답은 ①번이지만, 학생은 ③번('점진적이고 꾸준하게')을 선택했습니다. \`fair and square\`라는 표현의 뜻을 몰랐더라도, 바로 뒤 문장에서 "우리의 결과가 <strong>마땅히 받을 만한(deserved)</strong> 것이라고 믿는다"는 결정적 단서를 제공합니다. 즉, 이 표현은 '과정이 공정했기에, 그 결과는 온전히 내 몫으로 받아들여야 한다'는 <strong>정당성</strong>과 <strong>책임</strong>의 의미를 함축합니다. 여기서 ①번 선택지의 <strong>'justly'(정당하게)</strong>는 이 핵심 의미를 정확히 담고 있습니다. 반면, 학생이 고른 '점진적으로'는 과정의 공정성과 결과의 정당성이라는 글의 핵심 논리와는 전혀 관련이 없습니다. 이처럼 추상적인 지문일수록 핵심 단어가 문맥 속에서 어떤 의미로 사용되었는지 끝까지 추론하는 연습이 중요합니다.</p>
      `; 
    }

    // ======== 렌더링 로직 ========
    const mount = document.getElementById('mount');
    const searchEl = document.getElementById('search');
    const focusBox = document.getElementById('focusBox');
    let currentView = 'all';

    const thresholds = { excellent:85, ok:60 };
    const clamp = (n) => Math.max(0, Math.min(100, Number(n||0)));
    
    // B 규칙: 정수 반올림
    function scoreLabel(v){
      if(v==null) return '미평가';
      const n = Number(v);
      return Math.round(n) + '%';
    }
    function average(nums){ const vals = nums.filter(v => v!=null && !Number.isNaN(Number(v))); if(!vals.length) return null; return vals.reduce((a,b)=>a+Number(b),0)/vals.length; }
    function barColor(v){ if(v==null) return '#e5e7eb'; if(v>=thresholds.excellent) return 'var(--green)'; if(v>=thresholds.ok) return 'var(--yellow)'; return 'var(--red)'; }
    function statusColor(v){ if(v==null) return 'background:#e5e7eb;color:#374151'; if(v>=thresholds.excellent) return 'background:var(--green-100);color:var(--green)'; if(v>=thresholds.ok) return 'background:var(--yellow-100);color:var(--yellow)'; return 'background:var(--red-100);color:var(--red)';}

    function KCCard(id){
      const m = kcMeta[id]||{}; const v = kcScores[id] || {score:null, correct:0, total:0};
      const el = document.createElement('div');
      el.className = 'card p-16'; el.style.borderColor = '#e5e7eb';
      el.innerHTML = `
        <div class="kc-card">
          <div class="kc-ico">${m.area==='의사소통'?'💬':m.area==='문법'?'✍️':m.area==='어휘'?'🔤':m.area==='대화문'?'💬':'📖'}</div>
          <div style="flex:1;min-width:0">
            <div class="row" style="align-items:center;gap:6px;flex-wrap:wrap">
              <span class="small" style="font-weight:700">${id}</span>
              <span class="pill" style="${statusColor(v.score)}">${scoreLabel(v.score)}</span>
            </div>
            <div class="row between">
              <div class="small" style="font-weight:700;margin-top:4px">${m.label||''}</div>
              <div class="small muted" style="margin-top:4px">(${v.correct}/${v.total})</div>
            </div>
            <div class="small muted" style="margin-top:2px">${m.desc||''}</div>
            <div class="hbar" style="margin-top:8px"><span style="width:${clamp(v.score||0)}%; background:${barColor(v.score)}"></span></div>
          </div>
        </div>
      `;
      return el;
    }

    function TypeCard(t){
      const el = document.createElement('div');
      el.className = 'card p-16';
      const related = (t.kcs||[]).map(k=>`${k} (${scoreLabel((kcScores[k]||{}).score)})`).join(' · ');
      el.innerHTML = `
        <div class="type-card">
          <div style="min-width:0">
            <div class="row" style="gap:6px;flex-wrap:wrap">
              <span class="small" style="font-weight:700">${t.name}</span>
              <span class="small muted">[${t.code}]</span>
              <span class="pill" style="background:#f3f4f6;color:#374151">${t.area}</span>
            </div>
            <div class="small muted" style="margin-top:4px">(${t.correct}/${t.total})</div>
            <div class="small muted" style="margin-top:4px">연계 KC: ${related}</div>
          </div>
          <div style="text-align:right;min-width:120px;flex-shrink:0;">
            <div style="font-weight:700">${scoreLabel(t.score)}</div>
            <div class="hbar" style="margin-top:6px"><span style="width:${clamp(t.score||0)}%; background:${barColor(t.score)}"></span></div>
          </div>
        </div>
      `;
      return el;
    }
    
    function renderFocus(){
      const list = document.getElementById('focusList');
      if (!list) return;
      const entries = Object.entries(kcScores)
        .filter(([k,v])=>v.score!=null && v.score < thresholds.excellent)
        .sort((a,b)=> (a[1].score-b[1].score) || (String((kcMeta[a[0]]||{}).area) > String((kcMeta[b[0]]||{}).area) ? 1 : -1))
        .slice(0,3);

      list.innerHTML = entries.map(([k,v])=>{
        const m = kcMeta[k]||{};
        return `<li style="margin:6px 0"><strong>${k}</strong> (${m.label||''}) — <span class="pill" style="${statusColor(v.score)}">${scoreLabel(v.score)}</span></li>`;
      }).join('') || '<li class="muted">집중 보완이 필요한 영역이 없습니다. 잘하고 있어요!</li>';
    }

    function render(){
        const q = (searchEl.value||'').trim().toLowerCase();
        mount.innerHTML = '';
        focusBox.style.display = currentView === 'feedback' ? 'none' : 'block';

        ['core','reading'].forEach(id=>{
            if(!(currentView==='all' || currentView===id)) return;
            const g = groups.find(x=>x.id===id);
            if (!g) return;
            const items = g.items.filter(k=>{
                if(!q) return true;
                const m = kcMeta[k]||{};
                return k.toLowerCase().includes(q) || (m.label||'').toLowerCase().includes(q) || (m.desc||'').toLowerCase().includes(q) || (m.area||'').toLowerCase().includes(q);
            });
            if(!items.length) return;

            const sec = document.createElement('section');
            sec.className = 'card p-20'; sec.style.marginTop = '16px';
            const icon = id === 'core' ? '🧩' : '📖';
            sec.innerHTML = `<div class="between"><div><div class="title" style="font-size:18px">${icon} ${g.title}</div><div class="sub muted">${g.subtitle}</div></div></div>`;
            const grid = document.createElement('div');
            grid.className = 'grid grid-2 grid-3'; grid.style.marginTop = '12px';
            items.forEach(k => grid.appendChild(KCCard(k)));
            sec.appendChild(grid);
            mount.appendChild(sec);
        });

        if(currentView==='all' || currentView==='types'){
            const filteredTypes = typeScores.filter(t=>{
                if(!q) return true;
                return (t.name+t.code+t.area+(t.kcs||[]).join(',')).toLowerCase().includes(q);
            });
            if(filteredTypes.length){
                const sec = document.createElement('section');
                sec.className = 'card p-20'; sec.style.marginTop = '16px';
                sec.innerHTML = `<div class="between"><div><div class="title" style="font-size:18px">📝 문제 유형 성취도</div><div class="sub muted">총 ${totalProblemsAll}문제 중 ${totalCorrectAll}문제 정답</div></div></div>`;
                const grid = document.createElement('div');
                grid.className = 'grid grid-2'; grid.style.marginTop = '12px';
                filteredTypes.forEach(t => grid.appendChild(TypeCard(t)));
                sec.appendChild(grid);
                mount.appendChild(sec);
            }
        }

        if(currentView==='all' || currentView==='feedback'){
            const sec = document.createElement('section');
            sec.className = 'card p-24 feedback-section'; sec.style.marginTop = '16px';
            sec.innerHTML = getFeedbackHTML();
            mount.appendChild(sec);
        }
        
        const avgKCVal = average(Object.values(kcScores).map(k => k.score));
        document.getElementById('avgKC').textContent = scoreLabel(avgKCVal);
        document.getElementById('avgKCBar').style.width = clamp(avgKCVal) + '%';
        document.getElementById('avgKCBar').style.background = barColor(avgKCVal);

        const avgTypeVal = average(typeScores.map(t => t.score));
        document.getElementById('avgType').textContent = scoreLabel(avgTypeVal);
        document.getElementById('avgTypeBar').style.width = clamp(avgTypeVal) + '%';
        document.getElementById('avgTypeBar').style.background = barColor(avgTypeVal);
        
        const correctRateVal = totalProblemsAll > 0 ? (totalCorrectAll / totalProblemsAll) * 100 : null;
        document.getElementById('avgCorrectRate').textContent = scoreLabel(correctRateVal);
        document.getElementById('totalCount').textContent = `(${totalCorrectAll}/${totalProblemsAll})`;
        const correctRateBar = document.getElementById('avgCorrectRateBar');
        if (correctRateBar) {
            correctRateBar.style.width = clamp(correctRateVal) + '%';
            correctRateBar.style.background = barColor(correctRateVal);
        }
        renderFocus();
    }
    
    function init() {
        document.getElementById('printBtn').addEventListener('click', () => window.print());
        document.body.addEventListener('click', (e) => {
            const btn = e.target.closest('.view-btn');
            if(!btn) return;
            document.querySelectorAll('.view-btn').forEach(b => {
                b.classList.remove('active');
                b.setAttribute('aria-pressed', 'false');
            });
            btn.classList.add('active');
            btn.setAttribute('aria-pressed', 'true');
            currentView = btn.dataset.view || 'all';
            render();
        });
        searchEl.addEventListener('input', render);
        render();
    }

    document.addEventListener('DOMContentLoaded', init);
  })();
  </script>
</body>
</html>
