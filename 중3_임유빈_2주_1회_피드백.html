<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>중3 임유빈 학생 · 내신 학습 지식맵 (2025-09-01)</title>
  <style>
    :root{
      --bg: #f6f7fb; --card:#ffffff; --border:#e6e8ef; --text:#0f172a; --muted:#64748b;
      --indigo:#4f46e5; --green:#16a34a; --yellow:#f59e0b; --red:#ef4444; --blue:#3b82f6;
      --green-100:#dcfce7; --yellow-100:#fef9c3; --red-100:#fee2e2; --gray-100:#f1f5f9; --blue-100:#dbeafe;
    }
    *{box-sizing:border-box} body{margin:0;background:linear-gradient(180deg,#ffffff, var(--bg, #f6f7fb));color:var(--text, #0f172a);font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",Apple SD Gothic Neo,Pretendard,Helvetica,Arial,sans-serif}
    .container{max-width:1120px;margin:0 auto;padding:24px}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;}
    .between{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .card{background:var(--card, #ffffff);border:1px solid var(--border, #e6e8ef);border-radius:20px;box-shadow:0 4px 12px rgba(15,23,42,.04)}
    .p-16{padding:16px}.p-20{padding:20px}.p-24{padding:24px}
    .btn{border:1px solid var(--border, #e6e8ef);background:#fff;border-radius:12px;padding:10px 14px;cursor:pointer}
    .btn.active{background:var(--indigo, #4f46e5);color:#fff;border-color:var(--indigo, #4f46e5)}
    .input{border:1px solid var(--border, #e6e8ef);background:#fff;border-radius:12px;padding:10px 12px;min-width:260px}
    .grid{display:grid;gap:16px}
    @media(min-width:640px){.grid-2{grid-template-columns:repeat(2,minmax(0,1fr));}}
    @media(min-width:768px){.grid-3{grid-template-columns:repeat(3,minmax(0,1fr));}}
    .stat{min-width:240px}
    .hbar{height:8px;background:var(--gray-100, #f1f5f9);border-radius:999px;overflow:hidden}
    .hbar > span{display:block;height:100%}
    .pill{padding:3px 8px;border-radius:999px;font-size:11px;font-weight:700;display:inline-block}
    .legend .pill{border:1px solid var(--border, #e6e8ef);}
    .muted{color:var(--muted, #64748b)}
    .title{font-weight:800;letter-spacing:-.3px}
    .sub{font-size:12px}
    .kc-card{display:flex;gap:12px}
    .kc-ico{flex:0 0 auto;width:36px;height:36px;border-radius:12px;background:#f8fafc;display:grid;place-items:center;border:1px solid var(--border, #e6e8ef)}
    .small{font-size:12px}
    .type-card{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
    .kbd{font-variant-numeric:tabular-nums}
    .footer{font-size:12px;color:var(--muted, #64748b);display:flex;gap:8px;align-items:flex-start}
    /* 피드백 스타일 */
    .feedback-section h3 { font-size: 20px; margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px; }
    .feedback-section h4 { font-size: 16px; margin: 24px 0 8px 0; color: var(--indigo, #4f46e5); border-left: 3px solid var(--indigo, #4f46e5); padding-left: 8px;}
    .feedback-section .summary { font-size: 14px; color: var(--muted, #64748b); margin-top: -12px; margin-bottom: 24px; }
    .feedback-section hr { border: 0; border-top: 1px solid var(--border, #e6e8ef); margin: 24px 0; }
    .feedback-section blockquote { margin: 12px 0; padding: 12px; background-color: var(--gray-100, #f1f5f9); border-left: 4px solid var(--border, #e6e8ef); border-radius: 8px; font-size: 13px; }
    .feedback-section .analysis { margin-top: 8px; }
    .feedback-section .analysis strong { color: var(--text, #0f172a); }
    code { font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 12px; background: #f1f5f9; padding: 2px 6px; border-radius: 6px; }
    @media print { #printBtn, .view-btn, #search {display:none} }
  </style>
</head>
<body>
  <div class="container">
    <div class="between" style="gap:16px;flex-wrap:wrap">
      <div>
        <div class="title" style="font-size:24px">중3 6과 <span style="color:var(--indigo, #4f46e5)">KC & 유형 성취도</span> 대시보드</div>
        <div class="sub muted">학생: <strong>임유빈 학생</strong> · 시험일: <strong>2025-09-01</strong> · 교재: 동아(윤정미)</div>
      </div>
      <div class="row">
        <button id="printBtn" class="btn">내보내기/인쇄</button>
      </div>
    </div>

    <div class="row" style="margin-top:16px;align-items:center">
      <div class="row">
        <button data-view="all" class="btn view-btn active">전체</button>
        <button data-view="core" class="btn view-btn">기반</button>
        <button data-view="dialogue" class="btn view-btn">대화문</button>
        <button data-view="reading" class="btn view-btn">본문</button>
        <button data-view="types" class="btn view-btn">문제 유형</button>
        <button data-view="feedback" class="btn view-btn">피드백</button>
      </div>
      <div style="flex:1"></div>
      <input id="search" class="input" placeholder="KC 코드/이름/설명/유형 검색" />
    </div>

    <div class="grid grid-2" style="margin-top:16px">
      <div class="card p-16 stat">
        <div class="muted small">KC 평균 성취도</div>
        <div id="avgKC" class="title" style="font-size:22px;margin-top:4px">—</div>
        <div class="hbar" style="margin-top:8px"><span id="avgKCBar" style="width:0"></span></div>
      </div>
      <div class="card p-16 stat">
        <div class="muted small">문제 유형 평균 성취도</div>
        <div id="avgType" class="title" style="font-size:22px;margin-top:4px">—</div>
        <div class="hbar" style="margin-top:8px"><span id="avgTypeBar" style="width:0"></span></div>
      </div>
    </div>

    <div class="legend row card p-16" style="margin-top:16px">
      <div class="muted small">범례:</div>
      <span class="pill" style="background:var(--green-100, #dcfce7);color:var(--green, #16a34a)">우수 ≥ 85%</span>
      <span class="pill" style="background:var(--yellow-100, #fef9c3);color:var(--yellow, #f59e0b)">60–84%</span>
      <span class="pill" style="background:var(--red-100, #fee2e2);color:var(--red, #ef4444)">1–59%</span>
      <span class="pill" style="background:#e5e7eb;color:#374151">미평가</span>
    </div>

    <div id="mount"></div>

    <section class="card p-20" style="margin-top:16px" id="focusBox">
      <div class="between">
        <div>
          <div class="title" style="font-size:18px">📌 집중 보완 영역 (상위 3개 KC)</div>
          <div class="sub muted">점수가 낮은 순으로 자동 추천</div>
        </div>
      </div>
      <ol id="focusList" class="small" style="margin-top:8px;padding-left:18px"></ol>
    </section>

    <div class="footer" style="margin-top:16px">
      <span>색상 기준: 🟢 85% 이상, 🟡 60–84%, 🟥 1–59%, 회색=미평가. 검색 또는 상단 버튼으로 뷰를 전환할 수 있습니다. 인쇄 버튼으로 PDF 저장 가능.</span>
    </div>
  </div>
  
  <noscript>
    <div class="container">
      <section class="card p-20" style="margin-top:16px">
        <div class="title" style="font-size:18px">자바스크립트가 비활성화되어 요약 정보만 표시됩니다.</div>
      </section>
    </div>
  </noscript>

  <script>
  (() => { 'use strict';
    // ======== 데이터 설정 ========
    const studentName = "임유빈";
    const examDate = "2025-09-01";

    // KC 메타 (6과)
    const kcMeta = {
      "KC-6C1": { area: "의사소통", label: "축하 및 유감 표현하기", desc: "Congratulations / I'm sorry to hear that." },
      "KC-6C2": { area: "의사소통", label: "감정 표현하기", desc: "I'm excited/upset/happy 등" },
      "KC-6G1": { area: "문법", label: "과거완료 (had p.p.)", desc: "과거보다 더 이전 시점(대과거) 표현" },
      "KC-6G2": { area: "문법", label: "관계대명사 what", desc: "'~하는 것', 선행사 포함 명사절" },
      "KC-6V1": { area: "어휘", label: "골동품 거래 및 가치 관련 어휘", desc: "antique, valuable, reproduction, worth 등" },
      "KC-6D1": { area: "대화문", label: "학급 회장 당선 축하", desc: "I was elected as class president." },
      "KC-6D2": { area: "대화문", label: "마라톤 금메달 축하", desc: "Congratulations on winning the gold medal." },
      "KC-6D3": { area: "대화문", label: "스마트폰 분실에 대한 유감", desc: "I lost my smartphone. I'm upset." },
      "KC-6D4": { area: "대화문", label: "독감에 대한 유감", desc: "I have the flu. That's too bad." },
      "KC-6D5": { area: "대화문", label: "영어 말하기 대회 우승 축하", desc: "I won first prize in the English speech contest." },
      "KC-6D6": { area: "대화문", label: "스마트폰 고장에 대한 유감", desc: "My smartphone is broken." },
      "KC-6D7": { area: "대화문", label: "메인(연극 역할 배정)", desc: "Did I get the main role in the play?" },
      "KC-6R1": { area: "본문", label: "본문 1 (Boggis의 비밀)", desc: "골동품상 Boggis의 거래 방식" },
      "KC-6R2": { area: "본문", label: "본문 2 (귀중한 탁자 발견)", desc: "Rummins의 집에서 탁자를 발견하고 속이는 과정" },
      "KC-6R3": { area: "본문", label: "본문 3 (예상치 못한 결말)", desc: "Boggis의 속임수가 낳은 비극적 결말" }
    };

    // === 교체 대상 데이터 ===
    const kcScores = {
      "KC-6C1": 88.7, "KC-6C2": 100, "KC-6D1": 100, "KC-6D2": 100,
      "KC-6D3": 100, "KC-6D4": 100, "KC-6D7": 87.8, "KC-6G1": 86.7,
      "KC-6G2": 78, "KC-6R1": 93.6, "KC-6R2": 87.5, "KC-6R3": 72.1,
      "KC-6V1": 78.7
    };

    const groups = [
      { id: "core", title: "A. 기반 지식", subtitle: "의사소통·문법·어휘 기반", items:["KC-6C1","KC-6C2","KC-6G1","KC-6G2","KC-6V1"] },
      { id: "dialogue", title: "B-1. 적용 · 대화문", subtitle: "실제 대화 상황 이해", items:["KC-6D1","KC-6D2","KC-6D3","KC-6D4","KC-6D7"] }, // KC-6D5, 6D6은 문제없어 제외
      { id: "reading", title: "B-2. 적용 · 본문", subtitle: "One Lucky Sunday", items:["KC-6R1","KC-6R2","KC-6R3"] }
    ];

    const typeScores = [
      { code:"112", name:"대화 내용 일치/불일치", area:"대화", score:66.7, kcs:["KC-6C1", "KC-6D3", "KC-6D7"] },
      { code:"121", name:"대화 흐름/문맥 파악", area:"대화", score:100.0, kcs:["KC-6C1", "KC-6D7"] },
      { code:"122", name:"대화 순서 배열", area:"대화", score:100.0, kcs:["KC-6C1", "KC-6C2", "KC-6D2"] },
      { code:"124", name:"대화 빈칸 추론", area:"대화", score:100.0, kcs:["KC-6C2", "KC-6D1", "KC-6D7"] },
      { code:"131", name:"어휘 의미 파악 (대화)", area:"대화", score:100.0, kcs:["KC-6V1"] },
      { code:"142", name:"조건 맞게 영작 (대화)", area:"대화", score:84.6, kcs:["KC-6C2", "KC-6G2"] },
      { code:"241", name:"문장 전환하기", area:"문법", score:100.0, kcs:["KC-6G1", "KC-6G2"] },
      { code:"242", name:"조건에 맞게 영작하기", area:"문법", score:50.0, kcs:["KC-6G2", "KC-6R3", "KC-6G1"] },
      { code:"251", name:"어법상 옳은/틀린 것 고르기", area:"문법", score:88.7, kcs:["KC-6G1", "KC-6R2", "KC-6G2", "KC-6R3"] },
      { code:"252", name:"쓰임 구분하기", area:"문법", score:100.0, kcs:["KC-6V1"] },
      { code:"253", name:"빈칸에 적절한 어법/어휘", area:"문법", score:100.0, kcs:["KC-6G1", "KC-6R1"] },
      { code:"311", name:"글의 주제/제목 파악", area:"독해", score:100.0, kcs:["KC-6R2"] },
      { code:"312", name:"본문 내용 일치/불일치", area:"독해", score:73.7, kcs:["KC-6V1", "KC-6R1", "KC-6R3"] },
      { code:"314", name:"지문 요약하기", area:"독해", score:100.0, kcs:["KC-6V1", "KC-6R3"] },
      { code:"324", name:"지칭 추론하기", area:"독해", score:50.0, kcs:["KC-6C2", "KC-6R2", "KC-V1", "KC-6R1"] },
      { code:"325", name:"본문 빈칸 추론", area:"독해", score:0.0, kcs:["KC-6G1", "KC-6R3"] },
      { code:"331", name:"어휘 의미 파악 (본문)", area:"독해", score:66.7, kcs:["KC-6V1", "KC-6R2", "KC-6R1"] },
      { code:"332", name:"영영풀이 알기", area:"독해", score:100.0, kcs:["KC-6V1", "KC-6R2"] }
    ];

    // ======== 헬퍼 함수 ========
    const thresholds = { excellent: 85, ok: 60 };
    const clamp = (n) => Math.max(0, Math.min(100, Number(n || 0)));
    
    function statusColor(v, bgOnly = false) {
      if (v == null) return bgOnly ? '#e5e7eb' : 'background:#e5e7eb;color:#374151';
      if (v >= thresholds.excellent) return bgOnly ? 'var(--green-100, #dcfce7)' : 'background:var(--green-100, #dcfce7);color:var(--green, #16a34a)';
      if (v >= thresholds.ok) return bgOnly ? 'var(--yellow-100, #fef9c3)' : 'background:var(--yellow-100, #fef9c3);color:var(--yellow, #f59e0b)';
      return bgOnly ? 'var(--red-100, #fee2e2)' : 'background:var(--red-100, #fee2e2);color:var(--red, #ef4444)';
    }

    function barColor(v) {
      if (v == null) return '#e5e7eb';
      if (v >= thresholds.excellent) return 'var(--green, #16a34a)';
      if (v >= thresholds.ok) return 'var(--yellow, #f59e0b)';
      return 'var(--red, #ef4444)';
    }

    function scoreLabel(v) {
        if (v == null) return '미평가';
        const n = +v;
        return n === 100 ? '100%' : n.toFixed(1) + '%';
    }

    function average(nums) {
      const vals = nums.map(Number).filter(v => !Number.isNaN(v));
      if (!vals.length) return null;
      return vals.reduce((a, b) => a + b, 0) / vals.length;
    }

    function escapeHTML(s) {
      return String(s == null ? '' : s)
        .replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;').replace(/'/g, '&#039;');
    }
    
    function getFeedbackHTML() {
      return `
        <h3>임유빈 학생, 안녕하세요!</h3>
        <p class="summary" style="margin-top:0;">이번 6. Stories for All Time 단원 학습 결과에 대한 분석 피드백입니다. 대화문 이해와 같이 기초적인 부분은 아주 탄탄하지만, 문법 지식을 활용해 문장을 만들거나 글의 복잡한 내용을 깊이 있게 파고드는 데에는 어려움을 겪고 있어요. 어떤 부분을 보완해야 할지, 틀렸던 문제를 통해 함께 짚어보겠습니다.</p>
        <hr>
        <h4>✍️ 문법: 아는 규칙을 문장으로 만들지 못하는 단계</h4>
        <p>문법 규칙 자체는 잘 이해하고 있지만, 이 규칙을 활용해 완전한 문장을 만들어내는 <strong>영작(유형 242, 성취도 50.0%)</strong> 능력에 큰 약점을 보이고 있습니다. 특히 이번 단원의 핵심 문법인 <strong>관계대명사 what (KC-6G2, 성취도 78.0%)</strong>을 활용한 문장 구성에 어려움이 있었습니다.</p>
        <blockquote>
          <strong>대표 문제 예시 ([대표유형_문법] 5번)</strong>
          <p style="margin-bottom:4px;">[문제] 밑줄 친 (A)의 우리말과 일치하도록 &lt;보기&gt;의 단어를 사용하여 적절한 영어 문장을 영작하시오. (단, 관계대명사 what을 이용할 것)<br>(A) 그 탁자는 모든 딜러들이 꿈꾸던 것이었다.<br>&lt;보기&gt; every / dream</p>
          <p style="margin-top:4px;">➡️ <strong>학생 답안: 오답 (서술형)</strong></p>
        </blockquote>
        <p class="analysis"><strong>분석:</strong> 이 문제의 정답은 <code>The table was what every dealer dreamed of.</code> 입니다. 유빈 학생은 주어(<code>The table</code>)와 동사(<code>was</code>) 뒤에, '~하는 것'이라는 의미를 가진 명사 덩어리가 와야 한다는 점을 놓쳤을 가능성이 큽니다.<br>여기서 <strong><code>what</code></strong>은 선행사를 포함하여 <strong>'~하는 것(the thing that/which)'</strong>이라는 의미의 덩어리(명사절)를 만드는 핵심 재료입니다. '모든 딜러들이 꿈꾸던'(<code>every dealer dreamed of</code>)이라는 불완전한 문장 앞에 <code>what</code>을 붙여줌으로써, <strong>'모든 딜러들이 꿈꾸던 것'</strong>이라는 완벽한 명사 덩어리로 만들어주는 것이죠. 이처럼 <code>what</code>의 쓰임새를 문장 속에서 직접 활용하는 연습이 더 필요해 보입니다.</p>
        <hr>
        <h4>📚 본문 독해: 이야기의 결말을 놓치는 독해력</h4>
        <p>글의 전반부(<strong>KC-6R1, 성취도 93.6%</strong>)는 잘 이해했지만, 이야기가 절정으로 치닫고 예상치 못한 결말이 드러나는 후반부(<strong>KC-6R3, 성취도 72.1%</strong>)의 내용을 따라가는 데 큰 어려움을 겪었습니다. 특히 문맥을 통해 숨겨진 내용을 추리하는 <strong>빈칸 추론(유형 325, 성취도 0.0%)</strong>과 <strong>지칭 추론(유형 324, 성취도 50.0%)</strong>에서 약점이 두드러졌습니다.</p>
        <h5>핵심 약점 1: 빈칸 추론</h5>
        <blockquote>
            <strong>대표 문제 예시 ([대표유형_독해] 5번)</strong>
            <p style="margin-bottom:4px;">[지문] When Mr. Boggis came back, the legs had been cut off. ... Mr. Boggis was ______.</p>
            <p style="margin-bottom:4px;">[선택지]<br>① so shocked that he couldn't say anything<br>③ too gentle to touch the surface of the table</p>
            <p style="margin-top:4px;">➡️ <strong>학생 답안: ③번</strong></p>
        </blockquote>
        <p class="analysis"><strong>분석:</strong> 정답은 <strong>①번</strong>입니다. Boggis는 값비싼 <code>priceless</code> 탁자 전체를 헐값에 사려고 "다리만 필요하다"고 거짓말을 했습니다. 그런데 주인이 그 말을 그대로 믿고 정말로 탁자의 다리를 잘라버렸으니, Boggis의 계획은 완전히 망가진 상황이죠. 따라서 그는 '너무 <strong>충격을 받아서(shocked)</strong> 아무 말도 할 수 없었다'고 추론하는 것이 자연스럽습니다. 학생이 고른 ③번은 Boggis가 탁자를 소중히 여겼다는 점만 생각하고, 다리가 잘려 모든 가치가 사라진 결정적인 상황 변화를 읽어내지 못한 결과입니다.</p>
        <h5>핵심 약점 2: 지칭 추론</h5>
        <blockquote>
            <strong>대표 문제 예시 ([대단원평가] 6번)</strong>
            <p style="margin-bottom:4px;">[지문] People asked (나)him where he had got the furniture, but he just said, "(다)it is a secret."</p>
            <p style="margin-bottom:4px;">[선택지]<br>② (나)him - Cyril Boggis<br>③ (다)it - the furniture</p>
            <p style="margin-top:4px;">➡️ <strong>학생 답안: ②번</strong></p>
        </blockquote>
        <p class="analysis"><strong>분석:</strong> 정답은 <strong>③번</strong>입니다. 학생이 고른 ②번 (나)<code>him</code>은 문맥상 Boggis를 가리키는 것이 명확하므로 올바른 설명입니다. 진짜 함정은 ③번 (다)<code>it</code>이었습니다. 바로 앞 문장에서 사람들은 "<strong>그가 가구를 어디서 구했는지</strong>" 물었습니다. 따라서 Boggis가 "그것(<code>it</code>)은 비밀이다"라고 답했을 때, <code>it</code>이 가리키는 것은 단순한 '가구'가 아니라 <strong>'가구를 어디서 구했는지에 대한 정보'</strong> 전체입니다. 이처럼 대명사가 문장 전체의 내용을 가리킬 수 있다는 점을 항상 염두에 두어야 합니다.</p>
      `;
    }

    // ======== 렌더링 로직 ========
    const mount = document.getElementById('mount');
    const searchEl = document.getElementById('search');
    const focusBox = document.getElementById('focusBox');
    let currentView = 'all';

    function render() {
      const q = (searchEl.value || '').trim().toLowerCase();
      mount.innerHTML = '';
      focusBox.style.display = currentView === 'feedback' ? 'none' : 'block';

      ['core', 'dialogue', 'reading'].forEach(id => {
        if (!(currentView === 'all' || currentView === id)) return;
        const g = groups.find(x => x.id === id);
        if(!g) return;
        const items = g.items.filter(k => {
          if (!q) return true;
          const m = kcMeta[k] || {};
          return k.toLowerCase().includes(q) || (m.label || '').toLowerCase().includes(q) || (m.desc || '').toLowerCase().includes(q) || (m.area || '').toLowerCase().includes(q);
        });
        if (!items.length) return;

        const sec = document.createElement('section');
        sec.className = 'card p-20';
        sec.style.marginTop = '16px';
        sec.innerHTML = `
          <div class="between">
            <div>
              <div class="title" style="font-size:18px">${id === 'core' ? '🧩' : id === 'dialogue' ? '💬' : '📖'} ${escapeHTML(g.title)}</div>
              <div class="sub muted">${escapeHTML(g.subtitle)}</div>
            </div>
          </div>
        `;
        const grid = document.createElement('div');
        grid.className = 'grid grid-2 grid-3';
        grid.style.marginTop = '12px';
        items.forEach(k => grid.appendChild(KCCard(k)));
        sec.appendChild(grid);
        mount.appendChild(sec);
      });

      if (currentView === 'all' || currentView === 'types') {
        const filteredTypes = typeScores.filter(t => {
          if (!q) return true;
          return (t.name + t.code + t.area + (t.kcs || []).join(',')).toLowerCase().includes(q);
        });
        if (filteredTypes.length) {
          const sec = document.createElement('section');
          sec.className = 'card p-20';
          sec.style.marginTop = '16px';
          sec.innerHTML = `<div class="between"><div><div class="title" style="font-size:18px">📝 문제 유형 성취도</div><div class="sub muted">각 유형이 연계하는 KC와 성취도를 함께 확인</div></div></div>`;
          const grid = document.createElement('div');
          grid.className = 'grid grid-2';
          grid.style.marginTop = '12px';
          filteredTypes.forEach(t => grid.appendChild(TypeCard(t)));
          sec.appendChild(grid);
          mount.appendChild(sec);
        }
      }

      if (currentView === 'all' || currentView === 'feedback') {
        const sec = document.createElement('section');
        sec.className = 'card p-24 feedback-section';
        sec.style.marginTop = '16px';
        sec.innerHTML = getFeedbackHTML();
        mount.appendChild(sec);
      }

      const avgKCVal = average(Object.values(kcScores));
      document.getElementById('avgKC').textContent = scoreLabel(avgKCVal);
      const avgKCBar = document.getElementById('avgKCBar');
      avgKCBar.style.width = clamp(avgKCVal) + '%';
      avgKCBar.style.background = barColor(avgKCVal);

      const avgTypeVal = average(typeScores.map(t => t.score));
      document.getElementById('avgType').textContent = scoreLabel(avgTypeVal);
      const avgTypeBar = document.getElementById('avgTypeBar');
      avgTypeBar.style.width = clamp(avgTypeVal) + '%';
      avgTypeBar.style.background = barColor(avgTypeVal);

      renderFocus();
    }

    function KCCard(id) {
      const m = kcMeta[id] || {};
      const v = kcScores[id];
      const el = document.createElement('div');
      el.className = 'card p-16';
      el.style.borderColor = '#e5e7eb';
      el.innerHTML = `
        <div class="kc-card">
          <div class="kc-ico" title="${escapeHTML(m.area)}">${m.area === '의사소통' ? '💬' : m.area === '문법' ? '✍️' : m.area === '어휘' ? '🔤' : m.area === '대화문' ? '💬' : '📖'}</div>
          <div style="flex:1;min-width:0">
            <div class="row" style="align-items:center;gap:6px;flex-wrap:wrap">
              <span class="small" style="font-weight:700">${escapeHTML(id)}</span>
              <span class="pill" style="${statusColor(v)}">${scoreLabel(v)}</span>
            </div>
            <div class="small" style="font-weight:700;margin-top:4px">${escapeHTML(m.label || '')}</div>
            <div class="small muted" style="margin-top:2px">${escapeHTML(m.desc || '')}</div>
            <div class="hbar" style="margin-top:8px"><span style="width:${clamp(v || 0)}%; background:${barColor(v)}"></span></div>
          </div>
        </div>
      `;
      return el;
    }

    function TypeCard(t) {
      const el = document.createElement('div');
      el.className = 'card p-16';
      const related = (t.kcs || []).map(k => `${escapeHTML(k)} (${scoreLabel(kcScores[k])})`).join(' · ');
      el.innerHTML = `
        <div class="type-card">
          <div style="min-width:0">
            <div class="row" style="gap:6px;flex-wrap:wrap">
              <span class="small" style="font-weight:700">${escapeHTML(t.name)}</span>
              <span class="small muted">[${escapeHTML(t.code)}]</span>
              <span class="pill" style="background:#f3f4f6;color:#374151">${escapeHTML(t.area)}</span>
            </div>
            <div class="small muted" style="margin-top:4px">연계 KC: ${related}</div>
          </div>
          <div style="text-align:right;min-width:120px">
            <div style="font-weight:700">${scoreLabel(t.score)}</div>
            <div class="hbar" style="margin-top:6px"><span style="width:${clamp(t.score || 0)}%; background:${barColor(t.score)}"></span></div>
          </div>
        </div>
      `;
      return el;
    }

    function renderFocus() {
      const list = document.getElementById('focusList');
      const entries = Object.entries(kcScores)
        .filter(([k, v]) => v != null && v < thresholds.excellent)
        .sort((a, b) => (a[1] - b[1]) || ((kcMeta[a[0]]?.area || '') > (kcMeta[b[0]]?.area || '') ? 1 : -1))
        .slice(0, 3);

      const tips = {
          'KC-6R3': '이야기의 반전과 결말 부분의 인과관계를 다시 정리해 보세요.',
          'KC-6G2': '관계대명사 what이 문장 속에서 ‘~하는 것’으로 해석되는 예문을 만들어 보세요.',
          'KC-6V1': '본문에 나온 골동품/가치 관련 단어를 영영풀이와 함께 복습하세요.'
      };

      list.innerHTML = entries.map(([k, v]) => {
        const m = kcMeta[k] || {};
        const tip = tips[k] || '핵심 개념 복습 후 관련 문제를 풀어보세요.';
        return `<li style="margin:6px 0"><strong>${escapeHTML(k)}</strong> (${escapeHTML(m.label)}) — <span class="pill" style="${statusColor(v)}">${scoreLabel(v)}</span><br><span class="muted">처방: ${escapeHTML(tip)}</span></li>`;
      }).join('') || '<li class="muted">집중 보완이 필요한 영역이 없습니다. 잘하고 있어요!</li>';
    }

    function onTabClick(e) {
        const btn = e.target.closest('.view-btn');
        if (!btn) return;
        document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentView = btn.dataset.view;
        render();
    }

    function init(){
        document.getElementById('printBtn').addEventListener('click', () => window.print());
        document.body.addEventListener('click', onTabClick);
        document.getElementById('search').addEventListener('input', render);
        render();
    }

    document.addEventListener('DOMContentLoaded', init);
  })();
  </script>
</body>
</html>