<!DOCTYPE html>
<html lang="ko">
<head>
 <meta charset="utf-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1" />
 <title>중1_박지율 학생 · 내신 학습 지식맵 (2025-09-11)</title>
 <style>
  :root{
  --bg: #f6f7fb; --card:#ffffff; --border:#e6e8ef; --text:#0f172a; --muted:#64748b;
  --indigo:#4f46e5; --green:#16a34a; --yellow:#f59e0b; --red:#ef4444; --blue:#3b82f6;
  --green-100:#dcfce7; --yellow-100:#fef9c3; --red-100:#fee2e2; --gray-100:#f1f5f9; --blue-100:#dbeafe;
  }
  *{box-sizing:border-box} body{margin:0;background:linear-gradient(180deg,#ffffff, var(--bg));color:var(--text);font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",Apple SD Gothic Neo,Pretendard,Helvetica,Arial,sans-serif}
  .container{max-width:1120px;margin:0 auto;padding:24px}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;}
  .between{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:20px;box-shadow:0 4px 12px rgba(15,23,42,.04)}
  .p-16{padding:16px}.p-20{padding:20px}.p-24{padding:24px}
  .btn{border:1px solid var(--border);background:#fff;border-radius:12px;padding:10px 14px;cursor:pointer}
  .btn.active{background:var(--indigo);color:#fff;border-color:var(--indigo)}
  .input{border:1px solid var(--border);background:#fff;border-radius:12px;padding:10px 12px;min-width:260px}
  .grid{display:grid;gap:16px}
  @media(min-width:640px){.grid-2{grid-template-columns:repeat(2,minmax(0,1fr));}}
  @media(min-width:1024px){.grid-3{grid-template-columns:repeat(3,minmax(0,1fr));}}
  .stat{min-width:240px}
  .hbar{height:8px;background:var(--gray-100);border-radius:999px;overflow:hidden}
  .hbar > span{display:block;height:100%}
  .pill{padding:3px 8px;border-radius:999px;font-size:11px;font-weight:700;display:inline-block}
  .legend .pill{border:1px solid var(--border);}
  .muted{color:var(--muted)}
  .title{font-weight:800;letter-spacing:-.3px}
  .sub{font-size:12px}
  .kc-card{display:flex;gap:12px}
  .kc-ico{flex:0 0 auto;width:36px;height:36px;border-radius:12px;background:#f8fafc;display:grid;place-items:center;border:1px solid var(--border)}
  .small{font-size:12px}
  .type-card{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
  .kbd{font-variant-numeric:tabular-nums}
  .footer{font-size:12px;color:var(--muted);display:flex;gap:8px;align-items:flex-start}
  .feedback-section h3 { font-size: 20px; margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px; }
  .feedback-section h4 { font-size: 16px; margin: 24px 0 8px 0; color: var(--indigo); border-left: 3px solid var(--indigo); padding-left: 8px;}
  .feedback-section .summary { font-size: 14px; color: var(--muted); margin-top: -12px; margin-bottom: 24px; }
  .feedback-section hr { border: 0; border-top: 1px solid var(--border); margin: 24px 0; }
  .feedback-section blockquote { margin: 12px 0; padding: 12px; background-color: var(--gray-100); border-left: 4px solid var(--border); border-radius: 8px; font-size: 13px; }
  .feedback-section .analysis { margin-top: 8px; }
  .feedback-section .analysis strong { color: var(--text); }
 </style>
</head>
<body>
 <div class="container">
  <div class="between" style="gap:16px;flex-wrap:wrap">
    <div>
      <div id="mainTitle" class="title" style="font-size:24px">4과. Let's Travel Together! <span style="color:var(--indigo)">KC & 유형 성취도</span> 대시보드</div>
      <div id="subHeader" class="sub muted">이름: <strong>중1_박지율</strong> · 시험일: <strong>2025-09-11</strong> · 교재: 미래엔(문영인)</div>
    </div>
    <div class="row">
      <button id="printBtn" class="btn">내보내기/인쇄</button>
    </div>
  </div>

  <div class="row" style="margin-top:16px;align-items:center">
    <div class="row">
      <button data-view="all" class="btn view-btn active">전체</button>
      <button data-view="core" class="btn view-btn">기반</button>
      <button data-view="dialogue" class="btn view-btn">대화문</button>
      <button data-view="reading" class="btn view-btn">본문</button>
      <button data-view="types" class="btn view-btn">문제 유형</button>
      <button data-view="feedback" class="btn view-btn">피드백</button>
    </div>
    <div style="flex:1"></div>
    <input id="search" class="input" placeholder="KC 코드/이름/설명/유형 검색" />
  </div>

  <div class="grid grid-3" style="margin-top:16px">
    <div class="card p-16 stat">
      <div class="muted small">KC 평균 성취도</div>
      <div class="row" style="align-items:center;gap:6px">
        <div id="avgKC" class="title" style="font-size:22px;margin-top:4px">—</div>
        <div id="avgKCDiff" class="small" style="font-weight:700;"></div>
      </div>
      <div class="hbar" style="margin-top:8px"><span id="avgKCBar" style="width:0"></span></div>
    </div>
    <div class="card p-16 stat">
      <div class="muted small">문제 유형 평균 성취도</div>
      <div class="row" style="align-items:center;gap:6px">
        <div id="avgType" class="title" style="font-size:22px;margin-top:4px">—</div>
        <div id="avgTypeDiff" class="small" style="font-weight:700;"></div>
      </div>
      <div class="hbar" style="margin-top:8px"><span id="avgTypeBar" style="width:0"></span></div>
    </div>
    <div class="card p-16 stat">
      <div class="muted small">문제 정답률</div>
      <div class="row" style="align-items:baseline;gap:6px">
        <div id="avgCorrectRate" class="title" style="font-size:22px;margin-top:4px">—</div>
        <div id="totalCount" class="muted" style="font-weight:600; font-size: 14px;"></div>
      </div>
      <div class="hbar" style="margin-top:8px"><span id="avgCorrectRateBar" style="width:0"></span></div>
    </div>
  </div>

  <div class="legend row card p-16" style="margin-top:16px">
    <div class="muted small">범례:</div>
    <span class="pill" style="background:var(--green-100);color:var(--green)">우수 ≥ 85%</span>
    <span class="pill" style="background:var(--yellow-100);color:var(--yellow)">60–84%</span>
    <span class="pill" style="background:var(--red-100);color:var(--red)">1–59%</span>
    <span class="pill" style="background:#e5e7eb;color:#374151">미평가</span>
    <span class="pill" style="background:var(--blue-100);color:var(--blue)">NEW</span>
    <span class="muted small">▲▼ 이전 대비</span>
  </div>

  <div id="mount"></div>

  <section class="card p-20" style="margin-top:16px" id="focusBox">
    <div class="between">
      <div>
        <div class="title" style="font-size:18px">📌 집중 보완 영역 (상위 3개 KC)</div>
        <div class="sub muted">점수가 낮은 순으로 자동 추천</div>
      </div>
    </div>
    <ol id="focusList" class="small" style="margin-top:8px;padding-left:18px"></ol>
  </section>

  <div class="footer" style="margin-top:16px">
    <span>색상 기준: 🟢 85% 이상, 🟡 60–84%, 🟥 1–59%, 회색=미평가. 검색 또는 상단 버튼으로 뷰를 전환할 수 있습니다. 인쇄 버튼으로 PDF 저장 가능.</span>
  </div>
 </div>

 <script>
 (() => { 'use strict';
  // ======== 유틸 & 상수 (누락으로 인한 렌더 중단 원인) ========
  const thresholds = { excellent: 85, pass: 60 };
  const clamp = v => (v==null || isNaN(v)) ? 0 : Math.max(0, Math.min(100, v));
  const average = arr => {
    const nums = (arr||[]).filter(x => typeof x === 'number' && !isNaN(x));
    return nums.length ? nums.reduce((a,b)=>a+b,0) / nums.length : null;
  };
  const scoreLabel = v => {
    if (v == null || isNaN(v)) return '미평가';
    return (Math.abs(v - 100) < 0.05) ? '100%' : (v.toFixed(1) + '%');
  };
  const barColor = v => {
    if (v == null || isNaN(v)) return '#e5e7eb';
    if (v >= thresholds.excellent) return 'var(--green)';
    if (v >= thresholds.pass)      return 'var(--yellow)';
    if (v > 0)                     return 'var(--red)';
    return '#e5e7eb';
  };
  const statusColor = v => {
    if (v == null || isNaN(v)) return 'background:#e5e7eb;color:#374151';
    if (v >= thresholds.excellent) return 'background:var(--green-100);color:var(--green)';
    if (v >= thresholds.pass)      return 'background:var(--yellow-100);color:var(--yellow)';
    if (v > 0)                     return 'background:var(--red-100);color:var(--red)';
    return 'background:#e5e7eb;color:#374151';
  };

  // ======== 데이터(교체 대상) ========
  const studentName = "중1_박지율";
  const examDate = "2025-09-11";

  // --- 이전 성취도 ---
  const prevKcScores = {
    "KC-4C1": { score: 100.0, correct: 22, total: 22 },
    "KC-4C2": { score: 100.0, correct: 9, total: 9 },
    "KC-4D1": { score: 100.0, correct: 1, total: 1 },
    "KC-4D2": { score: 100.0, correct: 6, total: 6 },
    "KC-4D3": { score: 100.0, correct: 4, total: 4 },
    "KC-4D4": { score: 100.0, correct: 9, total: 9 },
    "KC-4G1": { score: 96.56, correct: 32, total: 33 },
    "KC-4G2": { score: 95.82, correct: 32, total: 33 },
    "KC-4R1": { score: 100.0, correct: 5, total: 5 },
    "KC-4R2": { score: 100.0, correct: 14, total: 14 },
    "KC-4R3": { score: 97.38, correct: 45, total: 46 },
    "KC-4R4": { score: 100.0, correct: 22, total: 22 },
    "KC-4V1": { score: 79.31, correct: 14, total: 15 }
  };
  const prevTypeScores = {
    "111": { score: 100.0, correct: 1, total: 1 },
    "112": { score: 100.0, correct: 10, total: 10 },
    "121": { score: 100.0, correct: 1, total: 1 },
    "122": { score: 100.0, correct: 7, total: 7 },
    "124": { score: 100.0, correct: 5, total: 5 },
    "131": { score: 100.0, correct: 1, total: 1 },
    "133": { score: 100.0, correct: 1, total: 1 },
    "142": { score: 100.0, correct: 11, total: 11 },
    "241": { score: 100.0, correct: 2, total: 2 },
    "242": { score: 100.0, correct: 12, total: 12 },
    "251": { score: 89.58, correct: 23, total: 24 },
    "252": { score: 100.0, correct: 5, total: 5 },
    "253": { score: 100.0, correct: 18, total: 18 },
    "311": { score: 100.0, correct: 4, total: 4 },
    "312": { score: 100.0, correct: 18, total: 18 },
    "313": { score: 100.0, correct: 3, total: 3 },
    "314": { score: 100.0, correct: 4, total: 4 },
    "321": { score: 100.0, correct: 4, total: 4 },
    "322": { score: 100.0, correct: 5, total: 5 },
    "323": { score: 100.0, correct: 1, total: 1 },
    "324": { score: 100.0, correct: 4, total: 4 },
    "325": { score: 100.0, correct: 8, total: 8 },
    "331": { score: 44.44, correct: 2, total: 3 },
    "332": { score: 100.0, correct: 4, total: 4 }
  };

  // --- 현재 성취도 ---
  const kcScores = {
    "KC-4C1": { score: 96.39, correct: 28, total: 29 },
    "KC-4C2": { score: 100.0, correct: 10, total: 10 },
    "KC-4D1": { score: 100.0, correct: 1, total: 1 },
    "KC-4D2": { score: 100.0, correct: 7, total: 7 },
    "KC-4D3": { score: 100.0, correct: 11, total: 11 },
    "KC-4D4": { score: 90.33, correct: 12, total: 13 },
    "KC-4G1": { score: 98.18, correct: 59, total: 60 },
    "KC-4G2": { score: 97.50, correct: 47, total: 48 },
    "KC-4R1": { score: 100.0, correct: 7, total: 7 },
    "KC-4R2": { score: 100.0, correct: 26, total: 26 },
    "KC-4R3": { score: 98.49, correct: 76, total: 77 },
    "KC-4R4": { score: 100.0, correct: 27, total: 27 },
    "KC-4V1": { score: 89.31, correct: 33, total: 34 }
  };
  const typeScores = [
    { code:"111", name:"핵심 내용 파악하기", area:"대화문", score:100.0, kcs:[], correct: 3, total: 3},
    { code:"112", name:"세부 내용 파악하기", area:"대화문", score:100.0, kcs:[], correct: 19, total: 19},
    { code:"121", name:"문맥 파악하기", area:"대화문", score:100.0, kcs:[], correct: 3, total: 3},
    { code:"122", name:"순서 배열하기", area:"대화문", score:100.0, kcs:[], correct: 8, total: 8},
    { code:"123", name:"밑줄 친 부분 추론하기", area:"대화문", score:100.0, kcs:[], correct: 2, total: 2},
    { code:"124", name:"빈칸 추론하기", area:"대화문", score:100.0, kcs:[], correct: 7, total: 7},
    { code:"131", name:"의미 파악하기", area:"대화문", score:100.0, kcs:[], correct: 3, total: 3},
    { code:"132", name:"영영풀이 알기", area:"대화문", score:100.0, kcs:[], correct: 1, total: 1},
    { code:"133", name:"표현 및 활용 알기", area:"대화문", score:100.0, kcs:[], correct: 1, total: 1},
    { code:"141", name:"해석 및 질문에 답하기", area:"대화문", score:0.0, kcs:[], correct: 0, total: 1},
    { code:"142", name:"영작하기", area:"대화문", score:100.0, kcs:[], correct: 15, total: 15},
    { code:"241", name:"문장 전환하기", area:"문법/어법", score:100.0, kcs:[], correct: 4, total: 4},
    { code:"242", name:"영작하기", area:"문법/어법", score:100.0, kcs:[], correct: 24, total: 24},
    { code:"251", name:"옳고 그름 판단하기", area:"문법/어법", score:94.35, kcs:[], correct: 42, total: 43},
    { code:"252", name:"쓰임 구분하기", area:"문법/어법", score:100.0, kcs:[], correct: 12, total: 12},
    { code:"253", name:"빈칸에 적절한 것 고르기", area:"문법/어법", score:100.0, kcs:[], correct: 23, total: 23},
    { code:"311", name:"핵심 내용 파악하기", area:"본문", score:100.0, kcs:[], correct: 6, total: 6},
    { code:"312", name:"세부 내용 파악하기", area:"본문", score:100.0, kcs:[], correct: 25, total: 25},
    { code:"313", name:"관련 내용 파악하기", area:"본문", score:100.0, kcs:[], correct: 4, total: 4},
    { code:"314", name:"지문 요약하기", area:"본문", score:100.0, kcs:[], correct: 6, total: 6},
    { code:"321", name:"문맥 파악하기", area:"본문", score:100.0, kcs:[], correct: 7, total: 7},
    { code:"322", name:"흐름 추론하기", area:"본문", score:100.0, kcs:[], correct: 6, total: 6},
    { code:"323", name:"내용 추론하기", area:"본문", score:100.0, kcs:[], correct: 2, total: 2},
    { code:"324", name:"밑줄 친 부분 추론하기", area:"본문", score:100.0, kcs:[], correct: 8, total: 8},
    { code:"325", name:"빈칸 추론하기", area:"본문", score:100.0, kcs:[], correct: 9, total: 9},
    { code:"331", name:"의미 파악하기", area:"본문", score:52.38, kcs:[], correct: 3, total: 4},
    { code:"332", name:"영영풀이 알기", area:"본문", score:100.0, kcs:[], correct: 4, total: 4},
    { code:"341", name:"우리말로 표현하기", area:"본문", score:100.0, kcs:[], correct: 1, total: 1},
    { code:"342", name:"영어로 표현하기", area:"본문", score:100.0, kcs:[], correct: 1, total: 1}
  ];

  const totalCorrectAll = typeScores.reduce((sum, t) => sum + (t.correct || 0), 0);
  const totalProblemsAll = typeScores.reduce((sum, t) => sum + (t.total || 0), 0);

  // KC 메타
  const kcMeta = {
    "KC-4C1": { area: "의사소통", label: "길 묻고 답하기", desc: "Where is it?, How can I get there? 등 길을 묻고 답하는 표현" },
    "KC-4C2": { area: "의사소통", label: "희망 · 기대 표현하기", desc: "I’m so excited!, I can’t wait! 등 기대감을 나타내는 표현" },
    "KC-4G1": { area: "문법", label: "명사 역할을 하는 동명사", desc: "동사에 -ing를 붙여 주어, 목적어, 보어 역할('~하는 것')을 하는 형태" },
    "KC-4G2": { area: "문법", label: "조동사 will", desc: "미래의 일이나 의지를 나타내는 'will + 동사원형' 형태의 긍정/부정/의문문" },
    "KC-4V1": { area: "어휘", label: "가족 여행 및 계획 관련 어휘", desc: "family trip, make a plan, ticket, bakery, studio 등 핵심 어휘" },
    "KC-4D1": { area: "대화문", label: "장소에 대한 기대와 궁금증", desc: "특정 장소(Moon Restaurant)에 대한 기대감과 위치 질문" },
    "KC-4D2": { area: "대화문", label: "콘서트에 대한 기대", desc: "콘서트 제안에 수락하며 기대감을 표현하는 대화" },
    "KC-4D3": { area: "대화문", label: "빵집 위치 묻고 답하기", desc: "가게 위치를 묻고 Go straight... 등으로 길을 안내하는 대화" },
    "KC-4D4": { area: "대화문", label: "메인(폭포 가는 길)", desc: "폭포로 가는 길을 지도를 보며 묻고 답하며 기대감을 표현하는 대화" },
    "KC-4R1": { area: "본문", label: "여행 계획 세우기 (도입)", desc: "할머니 생신을 맞아 화자가 직접 여행 계획을 세우는 도입부" },
    "KC-4R2": { area: "본문", label: "완벽한 계획 A", desc: "버스표, 케이크, 식당, 사진 촬영 등 구체적인 계획 내용" },
    "KC-4R3": { area: "본문", label: "계획의 차질과 차선책", desc: "버스를 놓치거나 케이크가 없는 문제 발생 및 해결 과정" },
    "KC-4R4": { area: "본문", label: "여행의 교훈", desc: "계획이 완벽하지 않아도 차선책 덕분에 훌륭한 여행이 되었음을 깨닫는 결론" }
  };

  const groups = [
    { id: "core", title: "A. 기반 지식", subtitle: "의사소통·문법·어휘 기반", items:["KC-4C1","KC-4C2","KC-4G1","KC-4G2","KC-4V1"] },
    { id: "dialogue", title: "B-1. 적용 · 대화문", subtitle: "실제 대화 상황 이해", items:["KC-4D1","KC-4D2","KC-4D3","KC-4D4"] },
    { id: "reading", title: "B-2. 적용 · 본문", subtitle: "Plan B Was Great, Too!", items:["KC-4R1","KC-4R2","KC-4R3","KC-4R4"] }
  ];

  // ======== 변화 계산(교정: kcMeta 전체 키셋 기준) ========
  const kcChanges = Object.keys(kcMeta).reduce((acc, key) => {
    const prev = prevKcScores[key];
    const curr = kcScores[key];
    acc[key] = { isNew: prev === undefined, diff: (prev !== undefined && curr !== undefined) ? (curr.score || 0) - (prev.score || 0) : 0 };
    return acc;
  }, {});
  const typeChanges = typeScores.reduce((acc, item) => {
    const prev = prevTypeScores[item.code];
    const curr = item;
    acc[item.code] = { isNew: prev === undefined, diff: (prev !== undefined && curr !== undefined) ? (curr.score || 0) - (prev.score || 0) : 0 };
    return acc;
  }, {});

  function getFeedbackHTML(){
    return `
  <h3>📊 상세 분석 및 맞춤 피드백</h3>
  <div>
    <p style="padding:12px; background-color: var(--gray-100); border-radius: 12px; font-size: 14px; margin-top:0;">
      <strong>총평:</strong> ${studentName} 학생의 학습 결과는 매우 훌륭합니다. 전체 성취도가 <strong>97.4%</strong>에 달하며, 대부분의 지식 영역에서 탄탄한 실력을 보여주고 있습니다. 이전 평가 대비 성취도가 더욱 향상된 점이 인상적입니다. 다만, 완벽을 향한 마지막 단계에서 '문법 지식의 서술형 적용'과 '문맥 속 어휘의 정확한 의미 파악'이라는 두 가지 세밀한 보완점을 찾아냈습니다.
    </p>
  </div>
  <hr>
  <h4>✍️ 문법: '아는 규칙'을 '쓰는 문장'으로 전환하는 능력</h4>
  <p class="summary">
    <strong>핵심 약점: 대화문 속 질문 영작 (유형 141 성취도: 0%)</strong>
    <br>조동사 'will', 동명사 등 핵심 문법 규칙에 대한 이해도는 매우 높지만, 이를 활용해 직접 질문을 만드는 서술형 문제에서 유일한 실수가 발생했습니다. 아는 지식을 실제 문장으로 구성하는 적용 능력을 마지막으로 점검할 필요가 있습니다.
  </p>
  <blockquote>
    <p><strong>대표 문제 예시 ([서술형 공략] 2번)</strong></p>
    <p><strong>[대화문]</strong><br>
    M: ... (A)그곳까지 가는데 시간이 얼마나 걸릴까요?<br>
    G: It'll take 8 minutes by car...</p>
    <p><strong>[문제]</strong> 밑줄 친 (A)의 우리말과 같은 뜻이 되도록 영작하시오.</p>
    <p>➡️ <strong>정답: How long will it take to get there?</strong> / <strong>학생 답안: How long does it take get there?</strong></p>
  </blockquote>
  <p class="analysis"><strong>분석:</strong> "시간이 얼마나 걸릴까?"라는 질문의 의도는 정확히 파악했지만, 두 가지 문법 규칙 적용에 오류가 있었습니다.<br>
    1. <strong>시제 불일치:</strong> 상대방의 대답이 미래 시제(\`It'll take...\`)이므로, 질문 역시 4과 핵심 문법인 조동사 \`will\`을 사용해 미래의 시간을 묻는 것이 자연스럽습니다. 현재 시제 \`does\`는 어색합니다.<br>
    2. <strong>구문 오류:</strong> \`it takes + 시간 + to부정사\` 구문에 따라 \`to get there\`가 되어야 합니다. 학생의 답안처럼 동사원형 \`get\`을 바로 쓸 수 없습니다.<br>
    이 문제의 핵심은 <strong>'의문사 + will + 주어 + 동사원형'</strong> 어순에 맞게 문장을 구성하는 능력을 평가하는 것이었습니다. 아는 문법 규칙을 실제 문장으로 만들어내는 서술형 훈련에 조금 더 집중한다면 완벽한 실력을 갖추게 될 것입니다.
  </p>
  <hr>
  <h4>🔍 어휘: '아는 단어'와 '쓰이는 단어'의 미세한 차이 감지 능력</h4>
  <p class="summary">
    <strong>핵심 약점: 다의어(多義語)의 문맥적 의미 구분 (유형 331 성취도: 52.4%)</strong>
    <br>단어의 대표적인 뜻은 잘 알지만, 하나의 단어가 문맥에 따라 여러 의미로 쓰일 때 이를 구분하는 능력이 부족합니다. 이는 <strong>여행 및 계획 관련 어휘(KC-4V1)</strong> 성취도가 다른 영역에 비해 소폭 낮은 이유이기도 합니다.
  </p>
  <blockquote>
    <p><strong>대표 문제 예시 ([최다오답 공략] 16번, 정답 문항)</strong></p>
    <p><strong>[대화문]</strong><br>
    G: It's so @close. I will go right now. Thanks.</p>
    <p><strong>[문제]</strong> 위 대화의 @close와 의미가 가장 비슷한 것은?</p>
    <p><strong>[선택지]</strong> ① far / ② near / ③ open ...</p>
    <p>➡️ <strong>정답: ②번 near</strong> / <strong>학생 답안: ②번 (정답)</strong></p>
  </blockquote>
  <p class="analysis"><strong>분석:</strong> 이 문제에서 학생은 정답을 정확히 맞혔습니다. \`close\`가 '닫다'가 아닌 '가까운'의 의미로 쓰였다는 것을 문맥을 통해 잘 파악했습니다. 이는 긍정적인 신호입니다.<br>
    하지만 <strong>유형 331</strong>의 성취도가 낮은 것은 바로 이런 다의어나, 비슷하게 생겼지만 뜻이 다른 단어(혼동 어휘) 문제에서 실수가 누적되었을 가능성을 보여줍니다. 지금처럼 문맥 안에서 단어의 정확한 쓰임을 끝까지 확인하는 습관을 유지하는 것이 중요합니다. 단순히 '아는 단어'라고 넘어가지 않고, "이 문장에서는 어떤 의미로 쓰였지?"라고 한 번 더 생각하는 연습이 어휘력을 완성하는 열쇠가 될 것입니다.
  </p>
    `;
  }

  // ======== 렌더 ========
  const mount = document.getElementById('mount');
  const searchEl = document.getElementById('search');
  const focusBox = document.getElementById('focusBox');
  let currentView = 'all';

  function render(){
    const q = (searchEl.value||'').trim().toLowerCase();
    mount.innerHTML = '';
    focusBox.style.display = currentView === 'feedback' ? 'none' : 'block';

    ['core','dialogue','reading'].forEach(id=>{
      if(!(currentView==='all' || currentView===id)) return;
      const g = groups.find(x=>x.id===id);
      if (!g) return;
      const items = g.items.filter(k=>{
        if(!q) return true;
        const m = kcMeta[k]||{};
        return k.toLowerCase().includes(q) || (m.label||'').toLowerCase().includes(q) || (m.desc||'').toLowerCase().includes(q) || (m.area||'').toLowerCase().includes(q);
      });
      if(!items.length) return;

      const sec = document.createElement('section');
      sec.className = 'card p-20';
      sec.style.marginTop = '16px';
      sec.innerHTML = `
        <div class="between">
          <div>
            <div class="title" style="font-size:18px">${id==='core'?'🧩':id==='dialogue'?'💬':'📖'} ${g.title}</div>
            <div class="sub muted">${g.subtitle}</div>
          </div>
        </div>
      `;
      const grid = document.createElement('div');
      grid.className = 'grid grid-2 grid-3';
      grid.style.marginTop = '12px';
      items.forEach(k => grid.appendChild(KCCard(k)));
      sec.appendChild(grid);
      mount.appendChild(sec);
    });

    if(currentView==='all' || currentView==='types'){
      const filteredTypes = typeScores.filter(t=>{
        if(!q) return true;
        return (t.name+t.code+t.area+(t.kcs||[]).join(',')).toLowerCase().includes(q);
      });
      if(filteredTypes.length){
        const sec = document.createElement('section');
        sec.className = 'card p-20';
        sec.style.marginTop = '16px';
        sec.innerHTML = `<div class="between"><div><div class="title" style="font-size:18px">📝 문제 유형 성취도</div><div class="sub muted">총 ${totalProblemsAll}문제 중 ${totalCorrectAll}문제 정답</div></div></div>`;
        const grid = document.createElement('div');
        grid.className = 'grid grid-2';
        grid.style.marginTop = '12px';
        filteredTypes.forEach(t => grid.appendChild(TypeCard(t)));
        sec.appendChild(grid);
        mount.appendChild(sec);
      }
    }

    if(currentView==='all' || currentView==='feedback'){
      const sec = document.createElement('section');
      sec.className = 'card p-24 feedback-section';
      sec.style.marginTop = '16px';
      sec.innerHTML = getFeedbackHTML();
      mount.appendChild(sec);
    }

    // ===== 평균 & 증감 표시 =====
    const avgKCVal = average(Object.values(kcScores).map(k => k.score));
    document.getElementById('avgKC').textContent = avgKCVal==null? '미평가' : scoreLabel(avgKCVal);
    document.getElementById('avgKCBar').style.width = (avgKCVal==null?0:clamp(avgKCVal))+'%';
    document.getElementById('avgKCBar').style.background = barColor(avgKCVal);

    const prevKCAvgVal = average(Object.keys(kcMeta).map(k => (prevKcScores[k] ? prevKcScores[k].score : null)));
    const kcDiffEl = document.getElementById('avgKCDiff');
    if(prevKCAvgVal==null){
      kcDiffEl.innerHTML = `<span class="pill" style="background:var(--blue-100);color:var(--blue)">NEW</span>`;
    }else{
      const diff = (avgKCVal??0) - prevKCAvgVal;
      if(Math.abs(diff) > 0.05){
        const color = diff>0 ? 'var(--green)' : 'var(--red)';
        const arrow = diff>0 ? '▲' : '▼';
        kcDiffEl.innerHTML = `<span style="color:${color};font-variant-numeric:tabular-nums">${arrow}${Math.abs(diff).toFixed(1)}</span>`;
      }else{
        kcDiffEl.textContent = '';
      }
    }

    const avgTypeVal = average(typeScores.map(t=>t.score));
    document.getElementById('avgType').textContent = avgTypeVal==null? '미평가' : scoreLabel(avgTypeVal);
    document.getElementById('avgTypeBar').style.width = (avgTypeVal==null?0:clamp(avgTypeVal))+'%';
    document.getElementById('avgTypeBar').style.background = barColor(avgTypeVal);

    const prevTypeAvgVal = average(typeScores.map(t => (prevTypeScores[t.code] ? prevTypeScores[t.code].score : null)));
    const typeDiffEl = document.getElementById('avgTypeDiff');
    if(prevTypeAvgVal==null){
      typeDiffEl.innerHTML = `<span class="pill" style="background:var(--blue-100);color:var(--blue)">NEW</span>`;
    }else{
      const diff = (avgTypeVal??0) - prevTypeAvgVal;
      if(Math.abs(diff) > 0.05){
        const color = diff>0 ? 'var(--green)' : 'var(--red)';
        const arrow = diff>0 ? '▲' : '▼';
        typeDiffEl.innerHTML = `<span style="color:${color};font-variant-numeric:tabular-nums">${arrow}${Math.abs(diff).toFixed(1)}</span>`;
      }else{
        typeDiffEl.textContent = '';
      }
    }

    const correctRateVal = totalProblemsAll > 0 ? (totalCorrectAll / totalProblemsAll) * 100 : null;
    document.getElementById('avgCorrectRate').textContent = correctRateVal === null ? '미평가' : scoreLabel(correctRateVal);
    document.getElementById('totalCount').textContent = `(${totalCorrectAll}/${totalProblemsAll})`;
    const correctRateBar = document.getElementById('avgCorrectRateBar');
    if (correctRateBar) {
      correctRateBar.style.width = (correctRateVal === null ? 0 : clamp(correctRateVal)) + '%';
      correctRateBar.style.background = barColor(correctRateVal);
    }

    renderFocus();
  }

  function KCCard(id){
    const m = kcMeta[id]||{}; const v = kcScores[id] || {score:null, correct:0, total:0};
    const change = kcChanges[id] || { isNew:true, diff:0 };
    let changeHTML = '';
    if(change.isNew){
      changeHTML = `<span class="pill" style="background:var(--blue-100); color:var(--blue);">NEW</span>`;
    }else if(Math.abs(change.diff) > 0.05){
      const color = change.diff > 0 ? 'var(--green)' : 'var(--red)';
      const arrow = change.diff > 0 ? '▲' : '▼';
      changeHTML = `<span style="font-size:11px;font-weight:700;color:${color};">${arrow}${Math.abs(change.diff).toFixed(1)}</span>`;
    }

    const el = document.createElement('div');
    el.className = 'card p-16'; el.style.borderColor = '#e5e7eb';
    el.innerHTML = `
    <div class="kc-card">
      <div class="kc-ico">${m.area==='의사소통'?'💬':m.area==='문법'?'✍️':m.area==='어휘'?'🔤':m.area==='대화문'?'💬':'📖'}</div>
      <div style="flex:1;min-width:0">
        <div class="row" style="align-items:center;gap:6px;flex-wrap:nowrap">
          <span class="small" style="font-weight:700;white-space:nowrap">${id}</span>
          <span class="pill" style="${statusColor(v.score)}">${scoreLabel(v.score)}</span>
          ${changeHTML}
        </div>
        <div class="row between">
          <div class="small" style="font-weight:700;margin-top:4px">${m.label||''}</div>
          <div class="small muted" style="margin-top:4px">(${v.correct}/${v.total})</div>
        </div>
        <div class="small muted" style="margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${m.desc||''}</div>
        <div class="hbar" style="margin-top:8px"><span style="width:${clamp(v.score||0)}%; background:${barColor(v.score)}"></span></div>
      </div>
    </div>
    `;
    return el;
  }

  function TypeCard(t){
    const change = typeChanges[t.code] || { isNew:true, diff:0 };
    let changeHTML = '';
    if(change.isNew){
      changeHTML = `<span class="pill" style="background:var(--blue-100); color:var(--blue); margin-left:4px;">NEW</span>`;
    }else if(Math.abs(change.diff) > 0.05){
      const color = change.diff > 0 ? 'var(--green)' : 'var(--red)';
      const arrow = change.diff > 0 ? '▲' : '▼';
      changeHTML = `<span style="font-size:12px;font-weight:700;color:${color};margin-left:4px;">${arrow}${Math.abs(change.diff).toFixed(1)}</span>`;
    }

    const el = document.createElement('div');
    el.className = 'card p-16';
    const related = (t.kcs||[]).map(k=>`${k} (${scoreLabel((kcScores[k]||{}).score)})`).join(' · ');
    el.innerHTML = `
    <div class="type-card">
      <div style="min-width:0">
        <div class="row" style="gap:6px;flex-wrap:wrap">
          <span class="small" style="font-weight:700">${t.name}</span>
          <span class="small muted">[${t.code}]</span>
          <span class="pill" style="background:#f3f4f6;color:#374151">${t.area}</span>
        </div>
        <div class="small muted" style="margin-top:4px">(${t.correct}/${t.total})</div>
        <div class="small muted" style="margin-top:4px">연계 KC: ${related}</div>
      </div>
      <div style="text-align:right;min-width:120px;flex-shrink:0;">
        <div class="row" style="justify-content:flex-end;gap:0;">
          <div style="font-weight:700">${scoreLabel(t.score)}</div>
          ${changeHTML}
        </div>
        <div class="hbar" style="margin-top:6px"><span style="width:${clamp(t.score||0)}%; background:${barColor(t.score)}"></span></div>
      </div>
    </div>
    `;
    return el;
  }

  function renderFocus(){
    const list = document.getElementById('focusList');
    if (!list) return;
    const entries = Object.entries(kcScores)
      .filter(([k,v])=>v.score!=null && v.score < thresholds.excellent)
      .sort((a,b)=> (a[1].score-b[1].score) || (kcMeta[a[0]].area > kcMeta[b[0]].area ? 1 : -1))
      .slice(0,3);

    const tips = {
      'KC-4V1': '다의어(miss, close 등)의 문맥별 의미 차이를 예문과 함께 정리하세요.',
      'KC-4D4': '긴 대화문에서 질문과 답변의 짝을 정확히 찾는 연습을 하세요.',
      'KC-4G2': '조동사 will/can 뒤 동사원형 규칙을 복습하고 영작에 적용하세요.',
      'KC-4G1': '동명사를 목적어로 사용하는 동사(enjoy, finish 등)를 암기하세요.'
    };

    list.innerHTML = entries.map(([k,v])=>{
      const m = kcMeta[k]||{}; const tip = tips[k]||'핵심 개념 복습과 유사 문항 반복 연습을 권장합니다.';
      return `<li style="margin:6px 0"><strong>${k}</strong> (${m.label}) — <span class="pill" style="${statusColor(v.score)}">${scoreLabel(v.score)}</span><br><span class="muted">처방: ${tip}</span></li>`;
    }).join('') || '<li class="muted">집중 보완이 필요한 영역이 없습니다. 잘하고 있어요!</li>';
  }

  function init() {
    const subHeaderEl = document.getElementById('subHeader');
    if (subHeaderEl) {
      subHeaderEl.innerHTML = `이름: <strong>${studentName}</strong> · 시험일: <strong>${examDate}</strong> · 교재: <strong>미래엔(문영인)</strong>`;
    }

    const mainTitleEl = document.querySelector('#mainTitle');
    if (mainTitleEl) {
      mainTitleEl.innerHTML = `4과. Let's Travel Together! <span style="color:var(--indigo)">KC & 유형 성취도</span> 대시보드`;
    }

    document.getElementById('printBtn').addEventListener('click', () => window.print());
    document.body.addEventListener('click', (e) => {
      const btn = e.target.closest('.view-btn');
      if(!btn) return;
      document.querySelectorAll('.view-btn').forEach(b => {
        b.classList.remove('active');
        b.setAttribute('aria-pressed', 'false');
      });
      btn.classList.add('active');
      btn.setAttribute('aria-pressed', 'true');
      currentView = btn.dataset.view || 'all';
      render();
    });
    document.getElementById('search').addEventListener('input', render);
    render();
  }

  document.addEventListener('DOMContentLoaded', init);
 })();
 </script>
</body>
</html>
